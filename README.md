# Сервис онлайн бронирования
## 1. Тема и целевая аудитория
### Основные функции:

- Поиск жилья для путешествий
- Поиск достопримечательностей и экскурсий
- Создание объявлений
- Бронирование жилья по объявлению

### Целевая аудитория:

140 млн. активных пользователей в месяц по всему миру:

- Северная Америка 10.7%
- Азия 4.8%
- Австралия 2.2%
- Южная Америка 4.8%
- Европа 50.7%

Остальные 26.8% распределены по миру.


## 2. Расчет нагрузки:

### Продуктовые метрики:

При расчете размера хранилища будем учитывать профили пользователей, объявления, данные о совершенных транзакциях за последние 5 лет и сообщения в переписках пользователей.
Для хранения изображений будем использовать CDN => размер изображений в хранилище учитывать не будем.

Средний размер профиля пользователя включающим в себя персональные данные пользователя, никнейм, ссылку на аватар и контактные данные(номер телефона, email) равным 1.5 КБ.
Средний размер объявления включающего в себя ссылки на изображения, и информацию об объявлении примем равным 50 КБ.
Средний размер данных с информацией об одной транзакции 0.5 КБ.

За последний год было совершено 895 млн. транзакций => размер транзакций за один год = 447.5 ГБ.
За последние 5 лет было совершено 3444 млн. транзакций => объем данных о транзакциях за последние 5 лет = 1.7 ТБ.


| Метрика                               | Значение |
|---------------------------------------|----------|
| Месячная аудитория                    | 140 млн  |
| Зарегистрированных пользователей      | 250 млн  |
| Дневная аудитория                     | 10 млн   |
| Средний размер хранилища пользователя | 1.5 КБ   |
| Размещенных объявлений                | 30 млн   |

#### Среднее значение действий пользователя в день:

| Действие                      | Среднее количество в день на пользователя |
|-------------------------------|-------------------------------------------|
| Поиск по параметрам           | 3                                         |
| Получение объявления          | 10                                        |
| Загрузка/изменение объявления | 0.1                                       |
| Регистрация/Авторизация       | 0.5                                       |
| Бронирование                  | 0.2                                       |

### Технические метрики:

#### Объем хранилища:

Средний размер хранилища на объявление - 50 КБ, количество объявлений - 30 млн. => Размер хранилища на объявления

```30 млн. * 50 КБ = 1.5 ТБ``` 

Средний размер хранилища на профиль - 1.5 КБ, количество пользователей 250 млн => Размер хранилища на пользователей 

```250 млн * 1.5 КБ = 375 ГБ```

Средний размер хранилища на транзакцию - 0.5 КБ, количество транзакций за последние 5 лет в среднем 3444 млн. => Размер хранилища на транзакции

```3444 млн. * 0.5 КБ = 1.7 ТБ```

Общий размер хранилища примерно равен 3.6 ТБ.

#### RPS

Пусть пиковый RPS и трафик в два раза больше средних своих значений

Тогда RPS на каждые действия

| Действие                      | Средний RPS | Пиковый RPS | 
|-------------------------------|-------------|-------------|
| Поиск по параметрам           | 347         | 694         |
| Получение объявления          | 1157        | 2314        |
| Загрузка/изменение объявления | 11          | 22          |
| Регистрация/Авторизация       | 55          | 110         |
| Бронирование                  | 22          | 44          |

#### Трафик:

При загрузке и изменении объявления отправляются данные объемом 50 КБ.

При загрузке списка объявлений размер передаваемых данных в среднем 1.2 МБ.

Средний размер страницы одного объявления - 1.3 МБ.

Средний объем данных профиля пересылаемый при Регистрации/авторизации 1.5 КБ.

| Действие                       | Среднее потребление трафика | Пиковое потребление трафика | 
|--------------------------------|-----------------------------|-----------------------------|
| Поиск по параметрам            | 416 Мбит/c                  | 832 Мбит/с                  |
| Получение объявления           | 1.5 Гбит/c                  | 3 Гбит/c                    |
| Загрузка/изменение объявления  | 0.6 Мбит/c                  | 1.2 Мбит/c                  |
| Регистрация/Авторизация        | 82.5 Кбит/с                 | 165 Кбит/с                  | 

## Глобальная балансировка нагрузки

Так как большая часть пользователей находится в Европе, то 2 датацентра разместим в Европе, в Германии и в Норвегии.
Разместим 1 датацентр в Северной Америке(США), 1 датацентр в Азии(Индия) и 1 датацентр в Австралии.

### Схема Глобальной балансировки:

- С помощью Geo Based DNS определяется регион
- С помощью BGP Anycast выбирается датацентр в выбранном регионе

## Источники

- https://www.tipranks.com/stocks/bkng/website-traffic
- https://www.stratosjets.com/blog/online-travel-statistics/
- https://www.businessofapps.com/data/booking-statistics/
- https://habr.com/ru/articles/323094/